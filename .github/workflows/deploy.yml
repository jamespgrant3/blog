name: deploy
on: [push]
jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      S3_BUCKET_NAME: jamespgrant3.com
    name: blog-deploy
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: use node
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: npm install
        run: npm ci
      - name: nextjs build
        run: npm run deploy
      - name: upload to s3
        run: aws s3 sync ./out s3://$S3_BUCKET_NAME/ --delete
      #- name: invalidate cloudfront distribution
      #  run: |
      #    aws cloudfront create-invalidation \
      #    --distribution-id $(aws cloudfront list-distributions --query "DistributionList.Items[0].Id" --output text) \
      #    --paths "/*"
